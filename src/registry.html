<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="./stylesheets/index.css">
    <style>
        * {
            box-sizing: border-box;
        }

        fieldset p {
            margin: 0 auto;
            margin-top: 30px;
        }

        fieldset legend {
            margin: 20px 0 0 90px;
        }

        .registry {
            margin-left: 90px;
        }

        form {
            margin: 0 auto;
        }
    </style>
</head>

<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <div id="top">

    </div>
    <fieldset style="width:500px;height:300px;margin:50px auto;">
        <legend>用户注册</legend>
        <form action="http://10.31.152.12/changhong/php/register.php" method="post">
            <p><label for="">用户名：</label><input type="text" name="username"><span></span></p>
            <p><label for="">密　码：</label><input type="password" name="password"></p>
            <p><label for="">邮　箱：</label><input type="text" name="email"></p>
            <p><input type="submit" value="注册" name="submit" class="registry"></p>
        </form>
    </fieldset>

    <div id="bot"></div>

    <script>
        $('#top').load('./top.html');
        $('#bot').load('./bottom.html');

    </script>
    <script>
        ! function ($) {
            let $user = $('input[name="username"]');
            let $userflag = true;

            $user.on('blur', function () {
                $.ajax({
                    type: 'post',
                    url: 'http://10.31.152.12/changhong/php/register.php',
                    data: {
                        username: $user.val()
                    }
                }).done(function (result) {
                    console.log(result)
                    if (!result) { //不存在
                        $('span').html('√').css('color', 'green');
                        $userflag = true;
                    } else {
                        $('span').html('改用户名已经存在').css('color', 'red');
                        $userflag = false;
                    }
                });
            });




            $('form').on('submit', function () {
                if ($user.val() == '') {
                    $('span').html('请输入用户名').css('color', 'red');
                    $userflag = false;
                };
                if (!$userflag) {
                    return false;
                }
            });


        }(jQuery);

    </script>
    <script src="script/register.js"></script>
    <script src="script/sha1.js"></script>

</body>

</html>